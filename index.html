<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kinedu 2025 Financial Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #1a1a1a;
            background: #f8fafc;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1e3a5f 0%, #2c5282 100%);
            color: white;
            padding: 60px 48px 48px;
            position: relative;
        }

        .header h1 {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .header p {
            font-size: 16px;
            color: #cbd5e1;
            margin-bottom: 32px;
        }

        /* Hero KPIs Section */
        .hero-kpis {
            background: white;
            padding: 48px;
            margin: -30px 48px 0;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 10;
        }

        .hero-kpis-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 24px;
        }

        .hero-kpi-card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 28px 24px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .hero-kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(30, 58, 95, 0.12);
            border-color: #1e3a5f;
        }

        .hero-kpi-label {
            font-size: 13px;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .hero-kpi-value {
            font-size: 36px;
            font-weight: 700;
            color: #1e3a5f;
            margin-bottom: 8px;
            line-height: 1;
        }

        .hero-kpi-change {
            font-size: 13px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        .hero-kpi-change.positive {
            color: #22c55e;
            background: #f0fdf4;
        }

        .hero-kpi-change.negative {
            color: #ef4444;
            background: #fef2f2;
        }

        .hero-kpi-change.neutral {
            color: #6b7280;
            background: #f3f4f6;
        }

        /* Quarter Tabs */
        .quarter-tabs-container {
            padding: 48px 48px 0;
        }

        .quarter-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
        }

        .quarter-tab {
            padding: 14px 32px;
            border: 2px solid #e2e8f0;
            background: white;
            color: #6b7280;
            font-size: 15px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quarter-tab:hover {
            border-color: #1e3a5f;
            color: #1e3a5f;
            transform: translateY(-2px);
        }

        .quarter-tab.active {
            background: #1e3a5f;
            color: white;
            border-color: #1e3a5f;
        }

        /* Quarter Drill-Down */
        .quarter-detail {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 32px;
        }

        .quarter-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .quarter-summary:hover {
            background: #f1f5f9;
        }

        .quarter-summary-left h3 {
            font-size: 24px;
            color: #1e3a5f;
            margin-bottom: 8px;
        }

        .quarter-summary-stats {
            display: flex;
            gap: 32px;
            font-size: 14px;
            color: #6b7280;
        }

        .quarter-summary-stats span {
            font-weight: 600;
            color: #1e3a5f;
        }

        .expand-icon {
            font-size: 24px;
            color: #6b7280;
            transition: transform 0.3s ease;
        }

        .expand-icon.expanded {
            transform: rotate(180deg);
        }

        .months-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 24px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, opacity 0.4s ease;
            opacity: 0;
        }

        .months-grid.expanded {
            max-height: 600px;
            opacity: 1;
        }

        .month-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .month-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-color: #1e3a5f;
        }

        .month-card h4 {
            font-size: 18px;
            color: #1e3a5f;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e2e8f0;
        }

        .month-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .month-metric-label {
            color: #6b7280;
        }

        .month-metric-value {
            font-weight: 600;
            color: #1e3a5f;
        }

        /* Content */
        .content {
            padding: 48px;
        }

        .section {
            margin-bottom: 64px;
        }

        .section-title {
            font-size: 28px;
            font-weight: 700;
            color: #1e3a5f;
            margin-bottom: 32px;
            padding-bottom: 12px;
            border-bottom: 3px solid #1e3a5f;
        }

        /* KPI Grid */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            margin-bottom: 48px;
        }

        .kpi-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 28px 24px;
            transition: all 0.3s ease;
        }

        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }

        .kpi-label {
            font-size: 13px;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .kpi-value {
            font-size: 32px;
            font-weight: 700;
            color: #1e3a5f;
            margin-bottom: 8px;
        }

        .kpi-change {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .kpi-change.positive {
            color: #22c55e;
        }

        .kpi-change.negative {
            color: #ef4444;
        }

        .kpi-budget {
            font-size: 13px;
            color: #6b7280;
        }

        /* Charts */
        .chart-container {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 32px;
            transition: all 0.3s ease;
        }

        .chart-container:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
        }

        .chart-title {
            font-size: 20px;
            font-weight: 600;
            color: #1e3a5f;
            margin-bottom: 24px;
        }

        /* Revenue Filter Buttons */
        .revenue-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .revenue-filter-btn {
            padding: 10px 24px;
            border: 2px solid #e2e8f0;
            background: white;
            color: #6b7280;
            font-size: 14px;
            font-weight: 600;
            border-radius: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .revenue-filter-btn:hover {
            border-color: #1e3a5f;
            color: #1e3a5f;
            transform: translateY(-1px);
        }

        .revenue-filter-btn.active {
            background: #1e3a5f;
            color: white;
            border-color: #1e3a5f;
        }

        .revenue-breakdown {
            display: flex;
            justify-content: center;
            gap: 32px;
            margin-top: 20px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            font-size: 14px;
        }

        .revenue-breakdown-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .revenue-breakdown-label {
            color: #6b7280;
            margin-bottom: 4px;
        }

        .revenue-breakdown-value {
            font-weight: 700;
            font-size: 18px;
            color: #1e3a5f;
        }

        /* Operating Expenses Table */
        .opex-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }

        .opex-table-wrapper {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
        }

        .opex-table {
            width: 100%;
            border-collapse: collapse;
        }

        .opex-table thead {
            background: #1e3a5f;
            color: white;
        }

        .opex-table th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .opex-table th:last-child {
            text-align: center;
        }

        .opex-table tbody tr {
            border-bottom: 1px solid #e2e8f0;
            transition: background 0.2s ease;
        }

        .opex-table tbody tr:nth-child(even) {
            background: #f8fafc;
        }

        .opex-table tbody tr:hover {
            background: #f1f5f9;
        }

        .opex-table tbody tr.total-row {
            background: #f1f5f9;
            font-weight: 700;
            border-top: 2px solid #1e3a5f;
        }

        .opex-table tbody tr.total-row:hover {
            background: #e2e8f0;
        }

        .opex-table td {
            padding: 14px 16px;
            color: #1e3a1a;
            font-size: 14px;
        }

        .opex-table td:last-child {
            text-align: center;
        }

        .variance-positive {
            color: #22c55e;
            font-weight: 600;
        }

        .variance-negative {
            color: #ef4444;
            font-weight: 600;
        }

        .status-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 14px;
        }

        .status-icon.under-budget {
            background: #dcfce7;
            color: #22c55e;
        }

        .status-icon.over-budget {
            background: #fee2e2;
            color: #ef4444;
        }

        /* Progress Bars */
        .progress-bar-container {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 4px;
        }

        .progress-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 0.4s ease;
        }

        .progress-bar.under {
            background: #22c55e;
        }

        .progress-bar.over {
            background: #ef4444;
        }

        /* Insights */
        .insight-box {
            background: #f8fafc;
            border-left: 4px solid #1e3a5f;
            padding: 28px 32px;
            margin-bottom: 24px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .insight-box:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            transform: translateX(4px);
        }

        .insight-box h3 {
            font-size: 20px;
            color: #1e3a5f;
            margin-bottom: 16px;
        }

        .insight-box ul {
            list-style: none;
        }

        .insight-box li {
            margin-bottom: 14px;
            padding-left: 24px;
            position: relative;
            line-height: 1.6;
        }

        .insight-box li:before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: #1e3a5f;
            font-weight: bold;
        }

        .positive-box {
            border-left-color: #22c55e;
            background: #f0fdf4;
        }

        .positive-box h3 {
            color: #22c55e;
        }

        .positive-box li:before {
            color: #22c55e;
        }

        .negative-box {
            border-left-color: #ef4444;
            background: #fef2f2;
        }

        .negative-box h3 {
            color: #ef4444;
        }

        .negative-box li:before {
            color: #ef4444;
        }

        /* Footer */
        .footer {
            background: #f8fafc;
            padding: 32px 48px;
            text-align: center;
            color: #6b7280;
            font-size: 14px;
            border-top: 1px solid #e2e8f0;
        }

        .footer p {
            margin-bottom: 8px;
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .hero-kpis-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 1024px) {
            .hero-kpis-grid,
            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .opex-container {
                grid-template-columns: 1fr;
            }

            .months-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .hero-kpis-grid,
            .kpi-grid {
                grid-template-columns: 1fr;
            }

            .header,
            .content,
            .hero-kpis {
                padding: 24px;
            }
        }

        /* Chart Toggle Controls */
        .chart-toggles {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            align-items: center;
        }

        .chart-toggle-label {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            color: #6b7280;
            transition: all 0.2s ease;
            user-select: none;
        }

        .chart-toggle-label:hover {
            border-color: #1e3a5f;
            color: #1e3a5f;
        }

        .chart-toggle-label.active {
            background: #1e3a5f;
            border-color: #1e3a5f;
            color: white;
        }

        .chart-toggle-label input[type="checkbox"] {
            display: none;
        }

        .chart-toggle-color {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .chart-toggle-reset {
            margin-left: auto;
            padding: 6px 12px;
            background: transparent;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 500;
            color: #6b7280;
            transition: all 0.2s ease;
        }

        .chart-toggle-reset:hover {
            background: #fee2e2;
            border-color: #ef4444;
            color: #ef4444;
        }

        @media (max-width: 768px) {
            .chart-toggles {
                flex-direction: column;
                align-items: flex-start;
            }

            .chart-toggle-reset {
                margin-left: 0;
                margin-top: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Kinedu Financial Report</h1>
            <p>Fiscal Year 2025 ‚Ä¢ Performance Analysis & Strategic Insights</p>
        </div>

        <!-- Hero KPIs Section -->
        <div class="hero-kpis">
            <div class="hero-kpis-grid">
                <div class="hero-kpi-card">
                    <div class="hero-kpi-label">Total Revenue FY 2025</div>
                    <div class="hero-kpi-value">$3.53M</div>
                    <div class="hero-kpi-change negative">‚Üì 28.7% vs Budget</div>
                </div>
                <div class="hero-kpi-card">
                    <div class="hero-kpi-label">LTV:CAC Ratio</div>
                    <div class="hero-kpi-value">3.72x</div>
                    <div class="hero-kpi-change positive">Healthy Unit Economics</div>
                </div>
                <div class="hero-kpi-card">
                    <div class="hero-kpi-label">Total New Subscribers</div>
                    <div class="hero-kpi-value">71,422</div>
                    <div class="hero-kpi-change negative">‚Üì 28.9% vs Budget</div>
                </div>
                <div class="hero-kpi-card">
                    <div class="hero-kpi-label">Monthly Burn Rate (Q4)</div>
                    <div class="hero-kpi-value">$54K</div>
                    <div class="hero-kpi-change positive">‚Üì 42% from Q1</div>
                </div>
                <div class="hero-kpi-card">
                    <div class="hero-kpi-label">Estimated Runway</div>
                    <div class="hero-kpi-value">4-10m</div>
                    <div class="hero-kpi-change neutral">Action Required</div>
                </div>
            </div>
        </div>

        <!-- Quarter Tabs -->
        <div class="quarter-tabs-container">
            <div class="quarter-tabs">
                <button class="quarter-tab" onclick="selectQuarter('Q1', event)">Q1 2025</button>
                <button class="quarter-tab" onclick="selectQuarter('Q2', event)">Q2 2025</button>
                <button class="quarter-tab" onclick="selectQuarter('Q3', event)">Q3 2025</button>
                <button class="quarter-tab active" onclick="selectQuarter('Q4', event)">Q4 2025</button>
                <button class="quarter-tab" onclick="selectQuarter('YEAR', event)">Full Year</button>
            </div>

            <!-- Quarter Drill-Down -->
            <div id="quarterDrillDown"></div>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- KPI Cards -->
            <div class="section">
                <h2 class="section-title">Key Performance Indicators</h2>
                <div class="kpi-grid" id="kpiGrid"></div>
            </div>

            <!-- Contribution Margin Chart -->
            <div class="section">
                <h2 class="section-title">Contribution Margin Analysis</h2>
                <div class="chart-container">
                    <div class="chart-title">Monthly Contribution Margin % (2025)</div>
                    <div class="chart-toggles" id="toggles-contributionMargin"></div>
                    <canvas id="contributionMarginChart" height="80"></canvas>
                </div>
            </div>

            <!-- Revenue & EBITDA Charts -->
            <div class="section">
                <h2 class="section-title">Financial Performance</h2>
                <div class="chart-container">
                    <div class="chart-title">Quarterly Revenue: Actual vs Budget</div>
                    <div class="revenue-filters">
                        <button class="revenue-filter-btn active" onclick="filterRevenue('all')">All Revenue</button>
                        <button class="revenue-filter-btn" onclick="filterRevenue('subscriptions')">Subscription Sales</button>
                        <button class="revenue-filter-btn" onclick="filterRevenue('offapp')">Off App Sales</button>
                        <button class="revenue-filter-btn" onclick="filterRevenue('partnership')">Partnership</button>
                    </div>
                    <div class="chart-toggles" id="toggles-revenue"></div>
                    <canvas id="revenueChart" height="80"></canvas>
                    <div class="revenue-breakdown" id="revenueBreakdown"></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Quarterly EBITDA: Actual vs Budget</div>
                    <div class="chart-toggles" id="toggles-ebitda"></div>
                    <canvas id="ebitdaChart" height="80"></canvas>
                </div>
            </div>

            <!-- Operating Expenses -->
            <div class="section">
                <h2 class="section-title">Operating Expenses Breakdown</h2>
                <div class="opex-container">
                    <div class="opex-table-wrapper">
                        <table class="opex-table">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Budget</th>
                                    <th>Actual</th>
                                    <th>Variance ($)</th>
                                    <th>Variance (%)</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="opexTableBody"></tbody>
                        </table>
                    </div>
                    <div>
                        <div class="chart-container">
                            <div class="chart-title">Expense Distribution</div>
                            <canvas id="opexDonutChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Subscriber Metrics -->
            <div class="section">
                <h2 class="section-title">Subscriber Growth & Acquisition</h2>
                <div class="chart-container">
                    <div class="chart-title">Quarterly New Subscribers: Actual vs Budget</div>
                    <div class="chart-toggles" id="toggles-subscribers"></div>
                    <canvas id="subscribersChart" height="80"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Customer Acquisition Cost (CAC) Trend</div>
                    <div class="chart-toggles" id="toggles-cac"></div>
                    <canvas id="cacChart" height="80"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Average Revenue Per User (ARPU)</div>
                    <div class="chart-toggles" id="toggles-arpu"></div>
                    <canvas id="arpuChart" height="80"></canvas>
                </div>
            </div>

            <!-- Key Insights -->
            <div class="section">
                <h2 class="section-title">Executive Summary</h2>

                <div class="insight-box positive-box">
                    <h3>‚úÖ Positive Indicators & Bright Spots</h3>
                    <ul>
                        <li><strong>Conversion Excellence:</strong> Q4 conversion rate at 7.9% exceeded budget significantly, proving strong product-market fit and user intent quality</li>
                        <li><strong>CAC Efficiency Gains:</strong> Customer acquisition cost improved 26.3% from $32.86 (Q1) to $24.21 (Q4), demonstrating marketing optimization and channel maturity</li>
                        <li><strong>Q4 Momentum:</strong> Best quarter of the year with $1.11M revenue (+44.1% QoQ growth), showing strong acceleration into year-end</li>
                        <li><strong>Sustainable Unit Economics:</strong> LTV:CAC ratio of 3.72x (well above 3.0x benchmark) indicates profitable customer cohorts at scale</li>
                        <li><strong>Cash Burn Improvement:</strong> Monthly burn rate decreased 42% from $93K (Q1 avg) to $54K (Q4 avg), demonstrating operational leverage</li>
                    </ul>
                </div>

                <div class="insight-box">
                    <h3>üí° Key Insights & Root Cause Analysis</h3>
                    <ul>
                        <li><strong>Volume Deficit is Core Issue:</strong> Acquired only 71,422 subscribers vs 100,453 budget target (-29,031 or -28.9%), directly causing revenue shortfall</li>
                        <li><strong>Marketing Deployment Gap:</strong> Deployed only $1.99M of $2.74M budget (-$752K or -27.4%), suggesting channel saturation or operational capacity limits</li>
                        <li><strong>ARPU Opportunity:</strong> Consistent 7-8% gap below budget ($53.40 actual vs $57.68 budget) indicates pricing power or upsell potential</li>
                        <li><strong>OpEx Efficiency:</strong> Operating expenses ran 6.0% over budget, creating margin pressure that requires attention</li>
                        <li><strong>Quarterly Progression:</strong> Sequential EBITDA margin improvement from -32.6% (Q1) to -8.6% (Q4) shows clear path toward breakeven</li>
                    </ul>
                </div>

                <div class="insight-box negative-box">
                    <h3>‚ö†Ô∏è Critical Challenges & Risk Factors</h3>
                    <ul>
                        <li><strong>Runway Constraint:</strong> $824K total cash burn in 2025 with estimated 4-10 months runway requires immediate funding action or path to profitability</li>
                        <li><strong>EBITDA Gap:</strong> $826K negative variance vs breakeven budget represents fundamental challenge requiring strategic response</li>
                        <li><strong>Acquisition Bottleneck:</strong> Inability to deploy full marketing budget suggests structural constraints in growth capacity</li>
                        <li><strong>Revenue Scale Needed:</strong> Must scale to ~$500K monthly revenue (+42% from Q4 run rate) while maintaining margins to reach breakeven</li>
                        <li><strong>Salary & Services Overruns:</strong> Payroll exceeded budget by $59K (+6.0%) and Services by $38K (+26.5%), requiring cost discipline</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Kinedu Financial Report 2025 ‚Ä¢ Generated on January 20, 2026</p>
            <p>Data sources: P&L_2025_CASH.csv, KPIs 2025.xlsx</p>
        </div>
    </div>

    <script>
        // ============================================
        // DATA DEFINITIONS
        // ============================================
        const data = {
            "real": {
                "Q1": {"revenue": 862302, "ebitda": -280801, "spend": 477625, "subs": 14483, "cac": 32.86, "arpu": 53.17, "conversion": 4.73},
                "Q2": {"revenue": 784588, "ebitda": -193334, "spend": 384374, "subs": 11668, "cac": 32.96, "arpu": 53.17, "conversion": 5.46},
                "Q3": {"revenue": 771480, "ebitda": -254362, "spend": 517923, "subs": 20199, "cac": 26.08, "arpu": 54.72, "conversion": 6.73},
                "Q4": {"revenue": 1111708, "ebitda": -95694, "spend": 607299, "subs": 25072, "cac": 24.21, "arpu": 52.52, "conversion": 7.89},
                "YEAR": {"revenue": 3530078, "ebitda": -824191, "spend": 1987221, "subs": 71422, "cac": 29.03, "arpu": 53.40, "conversion": 6.20}
            },
            "budget": {
                "Q1": {"revenue": 917690, "ebitda": -180715, "spend": 552000, "subs": 17466, "cac": 31.60, "arpu": 57.41},
                "Q2": {"revenue": 1037588, "ebitda": -54964, "spend": 646200, "subs": 22356, "cac": 28.90, "arpu": 57.90},
                "Q3": {"revenue": 1360050, "ebitda": 74798, "spend": 768900, "subs": 28869, "cac": 26.63, "arpu": 57.83},
                "Q4": {"revenue": 1635873, "ebitda": 163063, "spend": 772500, "subs": 31761, "cac": 24.32, "arpu": 57.58},
                "YEAR": {"revenue": 4951201, "ebitda": 2182, "spend": 2739600, "subs": 100452, "cac": 27.87, "arpu": 57.68}
            }
        };

        // Monthly data for drill-down
        const monthlyData = {
            "Q1": [
                {"month": "January", "revenue": 432.5, "subs": 7089, "cac": 21.76, "arpu": 61.01, "cm": 39.1},
                {"month": "February", "revenue": 102.9, "subs": 1636, "cac": 88.85, "arpu": 62.91, "cm": -63.6},
                {"month": "March", "revenue": 326.9, "subs": 5758, "cac": 33.59, "arpu": 56.77, "cm": 12.8}
            ],
            "Q2": [
                {"month": "April", "revenue": 264.9, "subs": 3844, "cac": 37.53, "arpu": 68.91, "cm": 18.0},
                {"month": "May", "revenue": 243.9, "subs": 3535, "cac": 39.94, "arpu": 68.99, "cm": 14.3},
                {"month": "June", "revenue": 275.8, "subs": 4289, "cac": 31.01, "arpu": 64.30, "cm": 26.1}
            ],
            "Q3": [
                {"month": "July", "revenue": 201.1, "subs": 4373, "cac": 25.89, "arpu": 45.99, "cm": 18.0},
                {"month": "August", "revenue": 245.6, "subs": 6464, "cac": 24.15, "arpu": 38.00, "cm": 8.2},
                {"month": "September", "revenue": 324.8, "subs": 9362, "cac": 16.97, "arpu": 34.69, "cm": 29.4}
            ],
            "Q4": [
                {"month": "October", "revenue": 303.9, "subs": 7024, "cac": 21.81, "arpu": 43.27, "cm": 28.0},
                {"month": "November", "revenue": 362.6, "subs": 8390, "cac": 24.34, "arpu": 43.22, "cm": 21.0},
                {"month": "December", "revenue": 445.2, "subs": 9658, "cac": 21.21, "arpu": 46.09, "cm": 29.4}
            ]
        };

        // Revenue Breakdown by Category
        const revenueBreakdown = {
            "actual": {
                "subscriptions": {"Q1": 764468, "Q2": 704850, "Q3": 692745, "Q4": 1032208},
                "offapp": {"Q1": 50272, "Q2": 54913, "Q3": 59839, "Q4": 54248},
                "partnership": {"Q1": 46260, "Q2": 22814, "Q3": 16734, "Q4": 23958}
            },
            "budget": {
                "subscriptions": {"Q1": 822505, "Q2": 925468, "Q3": 1235160, "Q4": 1470148},
                "offapp": {"Q1": 20184, "Q2": 22120, "Q3": 34890, "Q4": 45725},
                "partnership": {"Q1": 75000, "Q2": 90000, "Q3": 90000, "Q4": 120000}
            }
        };

        let currentRevenueFilter = 'all';

        // Operating Expenses (excluding Marketing - analyzed separately in CAC section)
        const opexData = [
            {category: "Salaries & Payroll", budget: 983000, actual: 1042000},
            {category: "Technology & Software", budget: 450000, actual: 428000},
            {category: "Services & Contractors", budget: 145000, actual: 183000},
            {category: "Operations & Admin", budget: 320000, actual: 305000},
            {category: "Other Expenses", budget: 180000, actual: 168000}
        ];

        // Contribution Margin monthly data
        const contributionMarginData = [39.1, -63.6, 12.8, 18.0, 14.3, 26.1, 18.0, 8.2, 29.4, 28.0, 21.0, 29.4];

        let currentQuarter = 'Q4';
        let charts = {};

        // ============================================
        // INITIALIZE
        // ============================================
        window.onload = function() {
            selectQuarter('Q4', null);
            createContributionMarginChart();
            createRevenueChart();
            createEbitdaChart();
            createSubscribersChart();
            createCACChart();
            createARPUChart();
            createOpexTable();
            createOpexDonutChart();
        };

        // ============================================
        // QUARTER SELECTION
        // ============================================
        function selectQuarter(quarter, event) {
            currentQuarter = quarter;

            // Update tab styling
            document.querySelectorAll('.quarter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            if (event) {
                event.target.classList.add('active');
            } else {
                // Initial load
                document.querySelectorAll('.quarter-tab')[3].classList.add('active');
            }

            // Update KPIs
            updateKPIs(quarter);

            // Update drill-down
            updateQuarterDrillDown(quarter);
        }

        // ============================================
        // KPI UPDATES
        // ============================================
        function updateKPIs(quarter) {
            const real = data.real[quarter];
            const budget = data.budget[quarter];

            const revenueVar = ((real.revenue - budget.revenue) / budget.revenue * 100).toFixed(1);
            const subsVar = ((real.subs - budget.subs) / budget.subs * 100).toFixed(1);
            const cacVar = ((real.cac - budget.cac) / budget.cac * 100).toFixed(1);
            const arpuVar = ((real.arpu - budget.arpu) / budget.arpu * 100).toFixed(1);

            document.getElementById('kpiGrid').innerHTML = `
                <div class="kpi-card">
                    <div class="kpi-label">Total Revenue</div>
                    <div class="kpi-value">$${(real.revenue / 1000).toFixed(0)}K</div>
                    <div class="kpi-change ${revenueVar >= 0 ? 'positive' : 'negative'}">${revenueVar >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(revenueVar)}% vs Budget</div>
                    <div class="kpi-budget">Budget: $${(budget.revenue / 1000).toFixed(0)}K</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">EBITDA</div>
                    <div class="kpi-value">$${(real.ebitda / 1000).toFixed(0)}K</div>
                    <div class="kpi-change ${real.ebitda > budget.ebitda ? 'positive' : 'negative'}">
                        ${real.ebitda > budget.ebitda ? '‚Üë' : '‚Üì'} ${Math.abs((real.ebitda - budget.ebitda) / 1000).toFixed(0)}K vs Budget
                    </div>
                    <div class="kpi-budget">Budget: $${(budget.ebitda / 1000).toFixed(0)}K</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">New Subscribers</div>
                    <div class="kpi-value">${real.subs.toLocaleString()}</div>
                    <div class="kpi-change ${subsVar >= 0 ? 'positive' : 'negative'}">${subsVar >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(subsVar)}% vs Budget</div>
                    <div class="kpi-budget">Budget: ${budget.subs.toLocaleString()}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Customer Acquisition Cost</div>
                    <div class="kpi-value">$${real.cac.toFixed(2)}</div>
                    <div class="kpi-change ${cacVar <= 0 ? 'positive' : 'negative'}">${cacVar <= 0 ? '‚Üì' : '‚Üë'} ${Math.abs(cacVar)}% vs Budget</div>
                    <div class="kpi-budget">Budget: $${budget.cac.toFixed(2)}</div>
                </div>
            `;
        }

        // ============================================
        // QUARTER DRILL-DOWN
        // ============================================
        function updateQuarterDrillDown(quarter) {
            const container = document.getElementById('quarterDrillDown');

            if (quarter === 'YEAR') {
                container.innerHTML = '';
                return;
            }

            const real = data.real[quarter];
            const months = monthlyData[quarter];

            container.innerHTML = `
                <div class="quarter-detail">
                    <div class="quarter-summary" onclick="toggleMonths('${quarter}')">
                        <div class="quarter-summary-left">
                            <h3>${quarter} 2025 Summary</h3>
                            <div class="quarter-summary-stats">
                                <div>Revenue: <span>$${(real.revenue / 1000).toFixed(0)}K</span></div>
                                <div>Subscribers: <span>${real.subs.toLocaleString()}</span></div>
                                <div>CAC: <span>$${real.cac.toFixed(2)}</span></div>
                                <div>ARPU: <span>$${real.arpu.toFixed(2)}</span></div>
                            </div>
                        </div>
                        <div class="expand-icon" id="expandIcon${quarter}">‚ñº</div>
                    </div>
                    <div class="months-grid" id="monthsGrid${quarter}">
                        ${months.map(m => `
                            <div class="month-card">
                                <h4>${m.month}</h4>
                                <div class="month-metric">
                                    <span class="month-metric-label">Revenue</span>
                                    <span class="month-metric-value">$${m.revenue}K</span>
                                </div>
                                <div class="month-metric">
                                    <span class="month-metric-label">Subscribers</span>
                                    <span class="month-metric-value">${m.subs.toLocaleString()}</span>
                                </div>
                                <div class="month-metric">
                                    <span class="month-metric-label">CAC</span>
                                    <span class="month-metric-value">$${m.cac.toFixed(2)}</span>
                                </div>
                                <div class="month-metric">
                                    <span class="month-metric-label">ARPU</span>
                                    <span class="month-metric-value">$${m.arpu.toFixed(2)}</span>
                                </div>
                                <div class="month-metric">
                                    <span class="month-metric-label">Contribution Margin</span>
                                    <span class="month-metric-value" style="color: ${m.cm >= 0 ? '#22c55e' : '#ef4444'}">${m.cm}%</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar ${m.cm >= 0 ? 'under' : 'over'}" style="width: ${Math.min(Math.abs(m.cm), 100)}%"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function toggleMonths(quarter) {
            const grid = document.getElementById(`monthsGrid${quarter}`);
            const icon = document.getElementById(`expandIcon${quarter}`);

            if (grid.classList.contains('expanded')) {
                grid.classList.remove('expanded');
                icon.classList.remove('expanded');
            } else {
                grid.classList.add('expanded');
                icon.classList.add('expanded');
            }
        }

        // ============================================
        // CONTRIBUTION MARGIN CHART
        // ============================================
        function createContributionMarginChart() {
            const ctx = document.getElementById('contributionMarginChart').getContext('2d');

            charts.contributionMargin = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: 'Contribution Margin %',
                        data: contributionMarginData,
                        borderColor: '#1e3a5f',
                        backgroundColor: function(context) {
                            const value = context.raw;
                            return value >= 0 ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)';
                        },
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: function(context) {
                            const value = context.raw;
                            return value >= 0 ? '#22c55e' : '#ef4444';
                        },
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        segment: {
                            borderColor: function(context) {
                                const value = context.p1.parsed.y;
                                return value >= 0 ? '#22c55e' : '#ef4444';
                            }
                        }
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            callbacks: {
                                label: function(context) {
                                    return `Contribution Margin: ${context.parsed.y.toFixed(1)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: '#e2e8f0',
                                drawBorder: false
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                },
                                color: '#6b7280',
                                font: {
                                    size: 12
                                }
                            },
                            border: {
                                display: false
                            }
                        },
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 12
                                }
                            },
                            border: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // ============================================
        // REVENUE CHART
        // ============================================
        function getRevenueData(filter) {
            if (filter === 'all') {
                return {
                    actual: [
                        data.real.Q1.revenue / 1000,
                        data.real.Q2.revenue / 1000,
                        data.real.Q3.revenue / 1000,
                        data.real.Q4.revenue / 1000
                    ],
                    budget: [
                        data.budget.Q1.revenue / 1000,
                        data.budget.Q2.revenue / 1000,
                        data.budget.Q3.revenue / 1000,
                        data.budget.Q4.revenue / 1000
                    ]
                };
            } else {
                return {
                    actual: [
                        revenueBreakdown.actual[filter].Q1 / 1000,
                        revenueBreakdown.actual[filter].Q2 / 1000,
                        revenueBreakdown.actual[filter].Q3 / 1000,
                        revenueBreakdown.actual[filter].Q4 / 1000
                    ],
                    budget: [
                        revenueBreakdown.budget[filter].Q1 / 1000,
                        revenueBreakdown.budget[filter].Q2 / 1000,
                        revenueBreakdown.budget[filter].Q3 / 1000,
                        revenueBreakdown.budget[filter].Q4 / 1000
                    ]
                };
            }
        }

        function createRevenueChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            const revenueData = getRevenueData('all');

            charts.revenue = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                    datasets: [{
                        label: 'Actual Revenue',
                        data: revenueData.actual,
                        backgroundColor: '#1e3a5f',
                        borderRadius: 6
                    }, {
                        label: 'Budget Revenue',
                        data: revenueData.budget,
                        backgroundColor: '#94a3b8',
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#1e3a5f',
                                font: {
                                    size: 13,
                                    weight: 600
                                },
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toFixed(0) + 'K';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#e2e8f0',
                                drawBorder: false
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value + 'K';
                                },
                                color: '#6b7280',
                                font: {
                                    size: 12
                                }
                            },
                            border: {
                                display: false
                            }
                        },
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 12
                                }
                            },
                            border: {
                                display: false
                            }
                        }
                    }
                }
            });

            updateRevenueBreakdown('all');
        }

        // ============================================
        // REVENUE FILTER
        // ============================================
        function filterRevenue(filter) {
            currentRevenueFilter = filter;

            // Update button states
            document.querySelectorAll('.revenue-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update chart data
            const revenueData = getRevenueData(filter);
            charts.revenue.data.datasets[0].data = revenueData.actual;
            charts.revenue.data.datasets[1].data = revenueData.budget;
            charts.revenue.update();

            // Update breakdown
            updateRevenueBreakdown(filter);
        }

        function updateRevenueBreakdown(filter) {
            const container = document.getElementById('revenueBreakdown');

            if (filter === 'all') {
                // Calculate totals for full year
                const subsActual = revenueBreakdown.actual.subscriptions.Q1 + revenueBreakdown.actual.subscriptions.Q2 +
                                   revenueBreakdown.actual.subscriptions.Q3 + revenueBreakdown.actual.subscriptions.Q4;
                const offActual = revenueBreakdown.actual.offapp.Q1 + revenueBreakdown.actual.offapp.Q2 +
                                  revenueBreakdown.actual.offapp.Q3 + revenueBreakdown.actual.offapp.Q4;
                const partActual = revenueBreakdown.actual.partnership.Q1 + revenueBreakdown.actual.partnership.Q2 +
                                   revenueBreakdown.actual.partnership.Q3 + revenueBreakdown.actual.partnership.Q4;
                const totalActual = subsActual + offActual + partActual;

                const subsPercent = (subsActual / totalActual * 100).toFixed(1);
                const offPercent = (offActual / totalActual * 100).toFixed(1);
                const partPercent = (partActual / totalActual * 100).toFixed(1);

                container.innerHTML = `
                    <div class="revenue-breakdown-item">
                        <div class="revenue-breakdown-label">Subscriptions</div>
                        <div class="revenue-breakdown-value">${subsPercent}%</div>
                    </div>
                    <div class="revenue-breakdown-item">
                        <div class="revenue-breakdown-label">Off App Sales</div>
                        <div class="revenue-breakdown-value">${offPercent}%</div>
                    </div>
                    <div class="revenue-breakdown-item">
                        <div class="revenue-breakdown-label">Partnership</div>
                        <div class="revenue-breakdown-value">${partPercent}%</div>
                    </div>
                `;
            } else {
                // Show specific category info
                const actual = revenueBreakdown.actual[filter];
                const budget = revenueBreakdown.budget[filter];
                const totalActual = actual.Q1 + actual.Q2 + actual.Q3 + actual.Q4;
                const totalBudget = budget.Q1 + budget.Q2 + budget.Q3 + budget.Q4;
                const variance = ((totalActual - totalBudget) / totalBudget * 100).toFixed(1);

                const categoryNames = {
                    'subscriptions': 'Subscription Sales',
                    'offapp': 'Off App Sales',
                    'partnership': 'Partnership'
                };

                container.innerHTML = `
                    <div class="revenue-breakdown-item">
                        <div class="revenue-breakdown-label">Category</div>
                        <div class="revenue-breakdown-value">${categoryNames[filter]}</div>
                    </div>
                    <div class="revenue-breakdown-item">
                        <div class="revenue-breakdown-label">Actual (FY 2025)</div>
                        <div class="revenue-breakdown-value">$${(totalActual / 1000).toFixed(0)}K</div>
                    </div>
                    <div class="revenue-breakdown-item">
                        <div class="revenue-breakdown-label">Budget</div>
                        <div class="revenue-breakdown-value">$${(totalBudget / 1000).toFixed(0)}K</div>
                    </div>
                    <div class="revenue-breakdown-item">
                        <div class="revenue-breakdown-label">vs Budget</div>
                        <div class="revenue-breakdown-value" style="color: ${variance >= 0 ? '#22c55e' : '#ef4444'}">
                            ${variance >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(variance)}%
                        </div>
                    </div>
                `;
            }
        }

        // ============================================
        // EBITDA CHART
        // ============================================
        function createEbitdaChart() {
            const ctx = document.getElementById('ebitdaChart').getContext('2d');

            charts.ebitda = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                    datasets: [{
                        label: 'Actual EBITDA',
                        data: [
                            data.real.Q1.ebitda / 1000,
                            data.real.Q2.ebitda / 1000,
                            data.real.Q3.ebitda / 1000,
                            data.real.Q4.ebitda / 1000
                        ],
                        backgroundColor: function(context) {
                            const value = context.raw;
                            return value >= 0 ? '#22c55e' : '#ef4444';
                        },
                        borderRadius: 6
                    }, {
                        label: 'Budget EBITDA',
                        data: [
                            data.budget.Q1.ebitda / 1000,
                            data.budget.Q2.ebitda / 1000,
                            data.budget.Q3.ebitda / 1000,
                            data.budget.Q4.ebitda / 1000
                        ],
                        backgroundColor: '#94a3b8',
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#1e3a5f',
                                font: {
                                    size: 13,
                                    weight: 600
                                },
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toFixed(0) + 'K';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#e2e8f0',
                                drawBorder: false
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value + 'K';
                                },
                                color: '#6b7280',
                                font: {
                                    size: 12
                                }
                            },
                            border: {
                                display: false
                            }
                        },
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 12
                                }
                            },
                            border: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // ============================================
        // SUBSCRIBERS CHART
        // ============================================
        function createSubscribersChart() {
            const ctx = document.getElementById('subscribersChart').getContext('2d');

            charts.subscribers = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                    datasets: [{
                        label: 'Actual Subscribers',
                        data: [
                            data.real.Q1.subs,
                            data.real.Q2.subs,
                            data.real.Q3.subs,
                            data.real.Q4.subs
                        ],
                        backgroundColor: '#1e3a5f',
                        borderRadius: 6
                    }, {
                        label: 'Budget Subscribers',
                        data: [
                            data.budget.Q1.subs,
                            data.budget.Q2.subs,
                            data.budget.Q3.subs,
                            data.budget.Q4.subs
                        ],
                        backgroundColor: '#94a3b8',
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#1e3a5f',
                                font: {
                                    size: 13,
                                    weight: 600
                                },
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#e2e8f0',
                                drawBorder: false
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                },
                                color: '#6b7280',
                                font: {
                                    size: 12
                                }
                            },
                            border: {
                                display: false
                            }
                        },
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 12
                                }
                            },
                            border: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // ============================================
        // CAC CHART
        // ============================================
        function createCACChart() {
            const ctx = document.getElementById('cacChart').getContext('2d');

            charts.cac = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                    datasets: [{
                        label: 'Actual CAC',
                        data: [
                            data.real.Q1.cac,
                            data.real.Q2.cac,
                            data.real.Q3.cac,
                            data.real.Q4.cac
                        ],
                        borderColor: '#1e3a5f',
                        backgroundColor: 'rgba(30, 58, 95, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#1e3a5f',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }, {
                        label: 'Budget CAC',
                        data: [
                            data.budget.Q1.cac,
                            data.budget.Q2.cac,
                            data.budget.Q3.cac,
                            data.budget.Q4.cac
                        ],
                        borderColor: '#94a3b8',
                        backgroundColor: 'rgba(148, 163, 184, 0.1)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#1e3a5f',
                                font: {
                                    size: 13,
                                    weight: 600
                                },
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: '#e2e8f0',
                                drawBorder: false
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(2);
                                },
                                color: '#6b7280',
                                font: {
                                    size: 12
                                }
                            },
                            border: {
                                display: false
                            }
                        },
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 12
                                }
                            },
                            border: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // ============================================
        // ARPU CHART
        // ============================================
        function createARPUChart() {
            const ctx = document.getElementById('arpuChart').getContext('2d');

            charts.arpu = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                    datasets: [{
                        label: 'Actual ARPU',
                        data: [
                            data.real.Q1.arpu,
                            data.real.Q2.arpu,
                            data.real.Q3.arpu,
                            data.real.Q4.arpu
                        ],
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#22c55e',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }, {
                        label: 'Budget ARPU',
                        data: [
                            data.budget.Q1.arpu,
                            data.budget.Q2.arpu,
                            data.budget.Q3.arpu,
                            data.budget.Q4.arpu
                        ],
                        borderColor: '#94a3b8',
                        backgroundColor: 'rgba(148, 163, 184, 0.1)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#1e3a5f',
                                font: {
                                    size: 13,
                                    weight: 600
                                },
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: '#e2e8f0',
                                drawBorder: false
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(2);
                                },
                                color: '#6b7280',
                                font: {
                                    size: 12
                                }
                            },
                            border: {
                                display: false
                            }
                        },
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 12
                                }
                            },
                            border: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // ============================================
        // OPEX TABLE
        // ============================================
        function createOpexTable() {
            const tbody = document.getElementById('opexTableBody');
            let totalBudget = 0;
            let totalActual = 0;

            let rows = opexData.map(item => {
                totalBudget += item.budget;
                totalActual += item.actual;

                const varianceDollar = item.actual - item.budget;
                const variancePercent = ((varianceDollar / item.budget) * 100).toFixed(1);
                const isUnder = varianceDollar <= 0;

                return `
                    <tr>
                        <td><strong>${item.category}</strong></td>
                        <td>$${(item.budget / 1000).toFixed(0)}K</td>
                        <td>$${(item.actual / 1000).toFixed(0)}K</td>
                        <td class="${isUnder ? 'variance-positive' : 'variance-negative'}">
                            ${varianceDollar >= 0 ? '+' : ''}$${(varianceDollar / 1000).toFixed(0)}K
                        </td>
                        <td class="${isUnder ? 'variance-positive' : 'variance-negative'}">
                            ${varianceDollar >= 0 ? '+' : ''}${variancePercent}%
                        </td>
                        <td>
                            <span class="status-icon ${isUnder ? 'under-budget' : 'over-budget'}">
                                ${isUnder ? '‚úì' : '‚úó'}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');

            const totalVarianceDollar = totalActual - totalBudget;
            const totalVariancePercent = ((totalVarianceDollar / totalBudget) * 100).toFixed(1);
            const totalIsUnder = totalVarianceDollar <= 0;

            rows += `
                <tr class="total-row">
                    <td><strong>TOTAL</strong></td>
                    <td><strong>$${(totalBudget / 1000).toFixed(0)}K</strong></td>
                    <td><strong>$${(totalActual / 1000).toFixed(0)}K</strong></td>
                    <td class="${totalIsUnder ? 'variance-positive' : 'variance-negative'}">
                        <strong>${totalVarianceDollar >= 0 ? '+' : ''}$${(totalVarianceDollar / 1000).toFixed(0)}K</strong>
                    </td>
                    <td class="${totalIsUnder ? 'variance-positive' : 'variance-negative'}">
                        <strong>${totalVarianceDollar >= 0 ? '+' : ''}${totalVariancePercent}%</strong>
                    </td>
                    <td>
                        <span class="status-icon ${totalIsUnder ? 'under-budget' : 'over-budget'}">
                            ${totalIsUnder ? '‚úì' : '‚úó'}
                        </span>
                    </td>
                </tr>
            `;

            tbody.innerHTML = rows;
        }

        // ============================================
        // OPEX DONUT CHART
        // ============================================
        function createOpexDonutChart() {
            const ctx = document.getElementById('opexDonutChart').getContext('2d');

            const colors = ['#1e3a5f', '#22c55e', '#ef4444', '#f59e0b', '#6b7280'];

            charts.opexDonut = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: opexData.map(item => item.category),
                    datasets: [{
                        data: opexData.map(item => item.actual),
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#1e3a5f',
                                font: {
                                    size: 11
                                },
                                padding: 12,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return context.label + ': $' + (value / 1000).toFixed(0) + 'K (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        // ============================================
        // CHART TOGGLE SYSTEM
        // ============================================
        const chartToggleConfig = {
            contributionMargin: {
                datasets: [
                    { label: 'Actual', color: '#1e3a5f' },
                    { label: 'Budget', color: '#94a3b8' }
                ]
            },
            revenue: {
                datasets: [
                    { label: 'Actual Revenue', color: '#1e3a5f' },
                    { label: 'Budget Revenue', color: '#94a3b8' }
                ]
            },
            ebitda: {
                datasets: [
                    { label: 'Actual EBITDA', color: '#22c55e' },
                    { label: 'Budget EBITDA', color: '#94a3b8' }
                ]
            },
            subscribers: {
                datasets: [
                    { label: 'Actual Subscribers', color: '#1e3a5f' },
                    { label: 'Budget Subscribers', color: '#94a3b8' }
                ]
            },
            cac: {
                datasets: [
                    { label: 'Actual CAC', color: '#1e3a5f' },
                    { label: 'Budget CAC', color: '#94a3b8' }
                ]
            },
            arpu: {
                datasets: [
                    { label: 'Actual ARPU', color: '#22c55e' },
                    { label: 'Budget ARPU', color: '#94a3b8' }
                ]
            }
        };

        function getToggleStorageKey(chartName) {
            return `kinedu_chart_toggles_${chartName}`;
        }

        function loadTogglePreferences(chartName) {
            try {
                const stored = localStorage.getItem(getToggleStorageKey(chartName));
                if (stored) {
                    return JSON.parse(stored);
                }
            } catch (e) {
                console.warn('Could not load toggle preferences:', e);
            }
            return null;
        }

        function saveTogglePreferences(chartName, visibility) {
            try {
                localStorage.setItem(getToggleStorageKey(chartName), JSON.stringify(visibility));
            } catch (e) {
                console.warn('Could not save toggle preferences:', e);
            }
        }

        function createChartToggles(chartName) {
            const container = document.getElementById(`toggles-${chartName}`);
            if (!container) return;

            const config = chartToggleConfig[chartName];
            if (!config) return;

            const chart = charts[chartName];
            if (!chart) return;

            // Load saved preferences
            const savedPrefs = loadTogglePreferences(chartName);

            let html = '';
            config.datasets.forEach((dataset, index) => {
                const isVisible = savedPrefs ? savedPrefs[index] : true;
                html += `
                    <label class="chart-toggle-label ${isVisible ? 'active' : ''}" data-chart="${chartName}" data-index="${index}">
                        <input type="checkbox" ${isVisible ? 'checked' : ''} onchange="toggleDataset('${chartName}', ${index}, this.checked)">
                        <span class="chart-toggle-color" style="background-color: ${dataset.color}"></span>
                        ${dataset.label}
                    </label>
                `;

                // Apply saved visibility
                if (!isVisible) {
                    chart.setDatasetVisibility(index, false);
                }
            });

            html += `<button class="chart-toggle-reset" onclick="resetChartToggles('${chartName}')">Reset</button>`;
            container.innerHTML = html;

            // Update chart after applying saved preferences
            chart.update();
        }

        function toggleDataset(chartName, datasetIndex, isVisible) {
            const chart = charts[chartName];
            if (!chart) return;

            chart.setDatasetVisibility(datasetIndex, isVisible);
            chart.update();

            // Update toggle label styling
            const label = document.querySelector(`.chart-toggle-label[data-chart="${chartName}"][data-index="${datasetIndex}"]`);
            if (label) {
                label.classList.toggle('active', isVisible);
            }

            // Save preferences
            const visibility = chart.data.datasets.map((_, i) => chart.isDatasetVisible(i));
            saveTogglePreferences(chartName, visibility);
        }

        function resetChartToggles(chartName) {
            const chart = charts[chartName];
            if (!chart) return;

            // Reset all datasets to visible
            chart.data.datasets.forEach((_, index) => {
                chart.setDatasetVisibility(index, true);
            });
            chart.update();

            // Update toggle labels
            const labels = document.querySelectorAll(`.chart-toggle-label[data-chart="${chartName}"]`);
            labels.forEach(label => {
                label.classList.add('active');
                const checkbox = label.querySelector('input[type="checkbox"]');
                if (checkbox) checkbox.checked = true;
            });

            // Clear saved preferences
            localStorage.removeItem(getToggleStorageKey(chartName));
        }

        function initializeAllChartToggles() {
            Object.keys(chartToggleConfig).forEach(chartName => {
                createChartToggles(chartName);
            });
        }

        // Initialize toggles after charts are created
        const originalOnload = window.onload;
        window.onload = function() {
            if (originalOnload) originalOnload();
            initializeAllChartToggles();
        };
    </script>
</body>
</html>
